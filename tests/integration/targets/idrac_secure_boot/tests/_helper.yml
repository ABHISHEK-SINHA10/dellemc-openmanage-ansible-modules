---
  # - Power on server and check LC status
- name: Power on server.
  dellemc.openmanage.redfish_powerstate:
    baseuri: "{{ idrac_ip }}"
    username: "{{ idrac_user }}"
    password: "{{ idrac_password }}"
    validate_certs: false
    reset_type: "On"

- name: Waiting for iDRAC to be in ready state
  vars:
    url1: "https://{{ idrac_ip }}"
    url2: "/redfish/v1/Dell/Managers/iDRAC.Embedded.1"
    url3: "/DellLCService/Actions/DellLCService.GetRemoteServicesAPIStatus"
  ansible.builtin.uri:
    url_username: "{{ idrac_user }}"
    url_password: "{{ idrac_password }}"
    timeout: 30
    validate_certs: false
    return_content: true
    force_basic_auth: true
    body_format: "json"
    headers:
      Content-Type: "application/json"
      Accept: "application/json"
      OData-Version: "4.0"
    url:
      "{{ url1 }}{{ url2 }}{{ url3 }}"
    method: POST
    body: {}
  until: status_result.json.Status == "Ready"
  register: status_result
  check_mode: false
  retries: 120
  delay: 30
  no_log: true
